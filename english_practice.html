<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Quest ‚öîÔ∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0c29;
    --card: #1a1640;
    --accent: #f7c948;
    --green: #4ade80;
    --red: #f87171;
    --blue: #60a5fa;
    --purple: #a78bfa;
    --text: #f0eaff;
    --muted: #9988cc;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image: radial-gradient(ellipse at 20% 20%, #2d1b69 0%, transparent 50%),
                      radial-gradient(ellipse at 80% 80%, #1a3a5c 0%, transparent 50%);
  }

  /* STARS */
  .stars { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
  .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) ease-in-out infinite alternate; }
  @keyframes twinkle { from { opacity: 0.1; transform: scale(1); } to { opacity: 0.8; transform: scale(1.3); } }

  /* HEADER */
  header {
    text-align: center;
    padding: 2rem 1rem 1rem;
    position: relative; z-index: 1;
  }
  header h1 {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(2rem, 6vw, 4rem);
    color: var(--accent);
    text-shadow: 0 0 30px #f7c94880, 0 4px 0 #b8860b;
    letter-spacing: 2px;
  }
  header p { color: var(--muted); font-size: 1.1rem; margin-top: 0.3rem; }

  /* SCORE BAR */
  .score-bar {
    display: flex; justify-content: center; align-items: center; gap: 2rem;
    padding: 0.8rem 2rem; margin: 0 auto 1.5rem;
    max-width: 600px; position: relative; z-index: 1;
    background: var(--card); border-radius: 50px;
    border: 2px solid #3d2f8a;
  }
  .score-item { text-align: center; }
  .score-item .label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); }
  .score-item .value { font-family: 'Fredoka One', cursive; font-size: 1.5rem; color: var(--accent); }
  .xp-bar-wrap { flex: 1; }
  .xp-bar-bg { background: #2d2060; border-radius: 10px; height: 10px; overflow: hidden; }
  .xp-bar-fill { height: 100%; background: linear-gradient(90deg, var(--purple), var(--accent)); border-radius: 10px; transition: width 0.5s ease; }

  /* SECTION NAV */
  .section-nav {
    display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;
    padding: 0 1rem 1.5rem; position: relative; z-index: 1;
  }
  .nav-btn {
    font-family: 'Fredoka One', cursive; font-size: 1rem;
    padding: 0.6rem 1.4rem; border-radius: 50px; border: 2px solid transparent;
    cursor: pointer; transition: all 0.2s; background: var(--card); color: var(--muted);
  }
  .nav-btn.active { background: var(--accent); color: #0f0c29; border-color: var(--accent); box-shadow: 0 0 20px #f7c94860; }
  .nav-btn:hover:not(.active) { border-color: var(--accent); color: var(--accent); }
  .nav-btn .badge { background: var(--green); color: #000; border-radius: 50px; font-size: 0.7rem; padding: 0 6px; margin-left: 6px; }

  /* MAIN CONTENT */
  main { max-width: 700px; margin: 0 auto; padding: 0 1rem 4rem; position: relative; z-index: 1; }

  /* SECTION */
  .section { display: none; }
  .section.active { display: block; }
  .section-title {
    font-family: 'Fredoka One', cursive; font-size: 1.6rem; margin-bottom: 1rem;
    text-align: center; color: var(--purple);
  }

  /* PROGRESS */
  .progress-wrap { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
  .progress-bg { flex: 1; background: #2d2060; border-radius: 10px; height: 8px; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--blue), var(--purple)); border-radius: 10px; transition: width 0.4s; }
  .progress-text { font-size: 0.85rem; color: var(--muted); white-space: nowrap; }

  /* QUESTION CARD */
  .q-card {
    background: var(--card); border-radius: 20px; padding: 2rem;
    border: 2px solid #3d2f8a; margin-bottom: 1rem;
    animation: slideIn 0.35s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .q-number { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); margin-bottom: 0.5rem; }
  .q-text {
    font-size: 1.15rem; line-height: 1.7; margin-bottom: 1.5rem;
    font-weight: 700;
  }
  .q-text .blank { color: var(--accent); border-bottom: 2px dashed var(--accent); padding: 0 4px; }

  /* INPUT */
  .input-row { display: flex; gap: 0.7rem; flex-wrap: wrap; }
  .answer-input {
    flex: 1; min-width: 200px; padding: 0.75rem 1.2rem;
    background: #0f0c29; border: 2px solid #3d2f8a; border-radius: 12px;
    color: var(--text); font-family: 'Nunito', sans-serif; font-size: 1rem;
    outline: none; transition: border-color 0.2s;
  }
  .answer-input:focus { border-color: var(--accent); }
  .answer-input.correct { border-color: var(--green); background: #052e16; }
  .answer-input.wrong { border-color: var(--red); background: #2d0b0b; }

  .btn {
    padding: 0.75rem 1.5rem; border-radius: 12px; border: none;
    font-family: 'Fredoka One', cursive; font-size: 1rem; cursor: pointer;
    transition: all 0.2s; letter-spacing: 0.5px;
  }
  .btn-check { background: var(--accent); color: #0f0c29; }
  .btn-check:hover { transform: scale(1.05); box-shadow: 0 0 20px #f7c94840; }
  .btn-next { background: var(--blue); color: #0f0c29; }
  .btn-next:hover { transform: scale(1.05); }
  .btn-disabled { opacity: 0.4; cursor: not-allowed; }

  /* FEEDBACK */
  .feedback {
    margin-top: 1rem; padding: 0.8rem 1.2rem; border-radius: 12px;
    font-weight: 700; font-size: 0.95rem; display: none;
  }
  .feedback.show { display: block; animation: popIn 0.3s ease; }
  @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .feedback.correct { background: #052e16; border: 1px solid var(--green); color: var(--green); }
  .feedback.wrong { background: #2d0b0b; border: 1px solid var(--red); color: var(--red); }
  .feedback.reveal { background: #1c1060; border: 1px solid var(--purple); color: var(--purple); }

  /* HINT */
  .hint { font-size: 0.85rem; color: var(--muted); margin-top: 0.8rem; font-style: italic; }

  /* SUMMARY SECTION */
  .hamlet-card {
    background: var(--card); border-radius: 20px; padding: 2rem;
    border: 2px solid #3d2f8a; margin-bottom: 1.5rem;
    line-height: 1.8;
  }
  .hamlet-card h3 { font-family: 'Fredoka One', cursive; color: var(--accent); margin-bottom: 1rem; font-size: 1.3rem; }
  .hamlet-card p { margin-bottom: 0.8rem; color: #c4b8e8; }

  .writing-area {
    width: 100%; min-height: 200px; padding: 1.2rem;
    background: #0f0c29; border: 2px solid #3d2f8a; border-radius: 16px;
    color: var(--text); font-family: 'Nunito', sans-serif; font-size: 1rem;
    resize: vertical; outline: none; line-height: 1.7;
    transition: border-color 0.2s;
  }
  .writing-area:focus { border-color: var(--accent); }
  .writing-tips { margin-top: 1rem; }
  .writing-tips li { color: var(--muted); font-size: 0.9rem; margin-bottom: 0.4rem; margin-left: 1.2rem; }
  .btn-submit-writing { width: 100%; margin-top: 1rem; background: var(--purple); color: white; padding: 1rem; font-size: 1.1rem; }
  .btn-submit-writing:hover { transform: scale(1.02); box-shadow: 0 0 30px #a78bfa40; }
  .word-count { text-align: right; font-size: 0.8rem; color: var(--muted); margin-top: 0.4rem; }
  .writing-feedback { margin-top: 1rem; padding: 1.2rem; background: #1c1060; border: 1px solid var(--purple); border-radius: 12px; display: none; }
  .writing-feedback.show { display: block; animation: popIn 0.3s ease; }

  /* RESULTS */
  .results-card {
    background: var(--card); border-radius: 20px; padding: 2.5rem;
    border: 2px solid var(--accent); text-align: center; margin-top: 1rem;
  }
  .results-card .big { font-family: 'Fredoka One', cursive; font-size: 4rem; color: var(--accent); }
  .results-card .sub { color: var(--muted); margin-top: 0.5rem; }
  .stars-anim { font-size: 2rem; margin: 1rem 0; }
  .btn-restart { background: var(--green); color: #0f0c29; margin-top: 1.5rem; padding: 0.8rem 2rem; }

  /* CONFETTI */
  .confetti-piece {
    position: fixed; width: 10px; height: 10px; border-radius: 2px;
    animation: confettiFall 2s ease-in forwards;
    z-index: 9999; pointer-events: none;
  }
  @keyframes confettiFall {
    0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
  }

  /* COMPLETED badge */
  .completed-badge {
    display: inline-block; background: var(--green); color: #000;
    font-size: 0.7rem; font-weight: 800; padding: 2px 8px;
    border-radius: 50px; margin-left: 8px; vertical-align: middle;
  }

  @media (max-width: 500px) {
    .q-card { padding: 1.2rem; }
    .input-row { flex-direction: column; }
    .answer-input { min-width: 100%; }
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<header>
  <h1>‚öîÔ∏è English Quest</h1>
  <p>Level up your grammar skills!</p>
</header>

<div class="score-bar">
  <div class="score-item">
    <div class="label">Score</div>
    <div class="value" id="scoreVal">0</div>
  </div>
  <div class="xp-bar-wrap">
    <div class="label" style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:4px;">XP</div>
    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpBar" style="width:0%"></div></div>
  </div>
  <div class="score-item">
    <div class="label">Streak üî•</div>
    <div class="value" id="streakVal">0</div>
  </div>
</div>

<div class="section-nav">
  <button class="nav-btn active" onclick="showSection('relative')" id="tab-relative">Relative Pronouns</button>
  <button class="nav-btn" onclick="showSection('gerund')" id="tab-gerund">Gerunds</button>
  <button class="nav-btn" onclick="showSection('hamlet')" id="tab-hamlet">Hamlet üìñ</button>
</div>

<main>
  <!-- RELATIVE PRONOUNS -->
  <div class="section active" id="section-relative">
    <div class="section-title">üîó Relative Pronouns</div>
    <div class="progress-wrap">
      <div class="progress-bg"><div class="progress-fill" id="rel-progress" style="width:0%"></div></div>
      <div class="progress-text" id="rel-progress-text">0 / 20</div>
    </div>
    <div id="rel-question-area"></div>
  </div>

  <!-- GERUNDS -->
  <div class="section" id="section-gerund">
    <div class="section-title">üèÉ Gerunds</div>
    <div class="progress-wrap">
      <div class="progress-bg"><div class="progress-fill" id="ger-progress" style="width:0%"></div></div>
      <div class="progress-text" id="ger-progress-text">0 / 20</div>
    </div>
    <div id="ger-question-area"></div>
  </div>

  <!-- HAMLET -->
  <div class="section" id="section-hamlet">
    <div class="section-title">üé≠ Hamlet ‚Äî Reading & Writing</div>

    <div class="hamlet-card">
      <h3>üìú The Story of Hamlet</h3>
      <p><strong>Hamlet</strong> is a famous play written by William Shakespeare around the year 1600. It is set in Denmark and tells the story of a young prince named Hamlet.</p>
      <p>Hamlet's father, the King of Denmark, has just died. His uncle <strong>Claudius</strong> quickly marries Hamlet's mother, <strong>Gertrude</strong>, and becomes the new king. Hamlet is very unhappy about this.</p>
      <p>One night, the <strong>ghost of Hamlet's father</strong> appears and tells Hamlet a shocking secret: Claudius murdered him by pouring poison into his ear while he was sleeping! The ghost asks Hamlet to take revenge.</p>
      <p>Hamlet is deeply troubled. He is not sure whether to believe the ghost, and he does not know what to do. He begins to act strangely ‚Äî so strangely that people wonder if he has gone mad. His girlfriend <strong>Ophelia</strong> and her father <strong>Polonius</strong> are worried.</p>
      <p>To find out the truth, Hamlet organises a play that shows the murder of his father. When Claudius watches it, he reacts with guilt ‚Äî which convinces Hamlet that the ghost was telling the truth.</p>
      <p>From this point on, things go badly wrong. Hamlet accidentally kills Polonius, thinking it is Claudius. Ophelia, heartbroken and confused, goes mad and drowns. Her brother <strong>Laertes</strong> blames Hamlet and wants revenge.</p>
      <p>In the final scene, there is a duel between Hamlet and Laertes. Claudius poisons Laertes' sword. During the fight, Hamlet's mother drinks poisoned wine by accident and dies. Laertes wounds Hamlet with the poisoned sword, but Hamlet also wounds Laertes. Before he dies, Laertes tells Hamlet the truth: it was all Claudius's plan. Hamlet finally kills Claudius ‚Äî and then dies himself.</p>
      <p>The play ends with almost everyone dead. A prince from Norway named <strong>Fortinbras</strong> arrives and takes over Denmark.</p>
      <p style="color: var(--accent); font-weight: 800;">üé≠ Famous quote: <em>"To be, or not to be ‚Äî that is the question."</em> ‚Äî Hamlet is wondering whether life is worth living.</p>
    </div>

    <div class="hamlet-card">
      <h3>‚úçÔ∏è Your Turn! Summarise Hamlet in your own words.</h3>
      <p style="color: var(--muted);">Write at least 5 sentences. Tell the story as if you're explaining it to a friend who has never heard of it. Use your own words ‚Äî don't just copy from above!</p>
      <ul class="writing-tips">
        <li>Who is the main character?</li>
        <li>What is the main problem or conflict?</li>
        <li>What are the most important events?</li>
        <li>How does the story end?</li>
        <li>What did you think of the story?</li>
      </ul>
      <textarea class="writing-area" id="hamlet-writing" placeholder="Start writing here..." oninput="updateWordCount()"></textarea>
      <div class="word-count" id="word-count">0 words</div>
      <button class="btn btn-submit-writing" onclick="submitWriting()">Submit my summary ‚úÖ</button>
      <div class="writing-feedback" id="writing-feedback"></div>
    </div>
  </div>
</main>

<script>
// ===== STARS =====
const starsContainer = document.getElementById('stars');
for (let i = 0; i < 80; i++) {
  const s = document.createElement('div');
  s.className = 'star';
  const size = Math.random() * 2.5 + 0.5;
  s.style.cssText = `width:${size}px;height:${size}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${2+Math.random()*4}s;animation-delay:${Math.random()*4}s`;
  starsContainer.appendChild(s);
}

// ===== GAME STATE =====
let score = 0, streak = 0, xp = 0;
const sectionsDone = { relative: false, gerund: false };

function addScore(points) {
  score += points;
  xp = Math.min(100, xp + points * 2);
  streak++;
  document.getElementById('scoreVal').textContent = score;
  document.getElementById('streakVal').textContent = streak;
  document.getElementById('xpBar').style.width = xp + '%';
  if (xp >= 100) { xp = 0; }
}
function resetStreak() { streak = 0; document.getElementById('streakVal').textContent = 0; }

// ===== CONFETTI =====
function launchConfetti(count = 30) {
  const colors = ['#f7c948','#4ade80','#60a5fa','#a78bfa','#f87171','#fb923c'];
  for (let i = 0; i < count; i++) {
    setTimeout(() => {
      const c = document.createElement('div');
      c.className = 'confetti-piece';
      c.style.cssText = `left:${10+Math.random()*80}%;top:0;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${1.5+Math.random()*1.5}s`;
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 3000);
    }, i * 50);
  }
}

// ===== QUESTIONS =====
const relativeQuestions = [
  { sentence: "The girl ___ sits next to me is very funny.", answer: "who", hint: "Use this for people." },
  { sentence: "The book ___ I read last week was amazing.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for things in a defining clause." },
  { sentence: "I know the boy ___ father is a doctor.", answer: "whose", hint: "This shows belonging ‚Äî like 'his' or 'her'." },
  { sentence: "The house ___ we visited yesterday is very old.", answer: "which", alts: ["that"], hint: "'which' or 'that' are both correct here." },
  { sentence: "She is the teacher ___ helped me the most.", answer: "who", hint: "Use this for people." },
  { sentence: "The film ___ we watched last night was scary.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for things." },
  { sentence: "He found the wallet ___ he had lost.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct here." },
  { sentence: "The man ___ car is parked outside is my uncle.", answer: "whose", hint: "This shows the car belongs to the man." },
  { sentence: "The dog ___ barked all night belongs to our neighbour.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for animals." },
  { sentence: "Paris is the city ___ I would most like to visit.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for places." },
  { sentence: "The students ___ passed the test were very happy.", answer: "who", hint: "Use this for people." },
  { sentence: "This is the phone ___ I bought last month.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for things." },
  { sentence: "The woman ___ umbrella I borrowed is my neighbour.", answer: "whose", hint: "This shows the umbrella belongs to the woman." },
  { sentence: "The restaurant ___ we ate at last Friday was excellent.", answer: "which", alts: ["that"], hint: "'which' or 'that' are both correct here." },
  { sentence: "The boy ___ won the race got a gold medal.", answer: "who", hint: "Use this for people." },
  { sentence: "I have a friend ___ speaks five languages.", answer: "who", hint: "Use this for people." },
  { sentence: "The cake ___ my mum made was delicious.", answer: "that", alts: ["which"], hint: "'that' or 'which' are both correct for things." },
  { sentence: "The scientist ___ discovery changed the world won a Nobel Prize.", answer: "whose", hint: "The discovery belongs to the scientist." },
  { sentence: "The island ___ they filmed the movie is in the Pacific.", answer: "where", hint: "Use this for places." },
  { sentence: "The year ___ my parents were born was 1975.", answer: "when", hint: "Use this for times." },
];

const gerundQuestions = [
  { sentence: "I enjoy ___ (read) books in the evening.", answer: "reading", hint: "After 'enjoy', use verb + -ing." },
  { sentence: "___ (swim) every day is very good for your health.", answer: "Swimming", hint: "A gerund can be the subject of a sentence." },
  { sentence: "She is interested in ___ (learn) French.", answer: "learning", hint: "After 'interested in', use verb + -ing." },
  { sentence: "He avoids ___ (eat) fast food.", answer: "eating", hint: "After 'avoid', use verb + -ing." },
  { sentence: "They finished ___ (do) their homework at 8 o'clock.", answer: "doing", hint: "After 'finish', use verb + -ing." },
  { sentence: "I am looking forward to ___ (see) you.", answer: "seeing", hint: "After 'looking forward to', use verb + -ing." },
  { sentence: "___ (travel) the world is my dream.", answer: "Travelling", hint: "This gerund is the subject of the sentence." },
  { sentence: "She is good at ___ (draw) portraits.", answer: "drawing", hint: "After 'good at', use verb + -ing." },
  { sentence: "He gave up ___ (smoke) two years ago.", answer: "smoking", hint: "After 'give up', use verb + -ing." },
  { sentence: "Would you mind ___ (close) the window?", answer: "closing", hint: "After 'mind', use verb + -ing." },
  { sentence: "I can't stand ___ (wait) in long queues.", answer: "waiting", hint: "After 'can't stand', use verb + -ing." },
  { sentence: "___ (cook) is one of my favourite hobbies.", answer: "Cooking", hint: "This gerund is the subject." },
  { sentence: "He denied ___ (steal) the money.", answer: "stealing", hint: "After 'deny', use verb + -ing." },
  { sentence: "She keeps ___ (talk) during the lesson.", answer: "talking", hint: "After 'keep', use verb + -ing." },
  { sentence: "I prefer ___ (cycle) to taking the bus.", answer: "cycling", hint: "After 'prefer', use verb + -ing." },
  { sentence: "They practised ___ (speak) English every day.", answer: "speaking", hint: "After 'practise', use verb + -ing." },
  { sentence: "___ (run) a marathon requires a lot of training.", answer: "Running", hint: "This gerund is the subject." },
  { sentence: "He is afraid of ___ (fly) in aeroplanes.", answer: "flying", hint: "After 'afraid of', use verb + -ing." },
  { sentence: "We decided against ___ (move) to another city.", answer: "moving", hint: "After 'decide against', use verb + -ing." },
  { sentence: "I am thinking about ___ (start) a new hobby.", answer: "starting", hint: "After 'thinking about', use verb + -ing." },
];

// ===== QUESTION ENGINE =====
function buildSection(questions, prefix, areaId, progressBarId, progressTextId) {
  let current = 0, attempts = 0;
  let sectionScore = 0;

  function normalise(s) { return s.trim().toLowerCase().replace(/[.,!?]/g,''); }

  function render() {
    if (current >= questions.length) {
      showResults();
      return;
    }
    const q = questions[current];
    const pct = (current / questions.length) * 100;
    document.getElementById(progressBarId).style.width = pct + '%';
    document.getElementById(progressTextId).textContent = current + ' / ' + questions.length;

    const area = document.getElementById(areaId);
    const display = q.sentence.replace('___', '<span class="blank">___</span>');
    area.innerHTML = `
      <div class="q-card">
        <div class="q-number">Question ${current + 1} of ${questions.length}</div>
        <div class="q-text">${display}</div>
        <div class="input-row">
          <input class="answer-input" id="${prefix}-input" type="text" placeholder="Type your answer..." autocomplete="off" onkeydown="if(event.key==='Enter') checkAnswer('${prefix}')">
          <button class="btn btn-check" id="${prefix}-check-btn" onclick="checkAnswer('${prefix}')">Check ‚úì</button>
          <button class="btn btn-next btn-disabled" id="${prefix}-next-btn" onclick="nextQ('${prefix}')" disabled>Next ‚Üí</button>
        </div>
        <div class="feedback" id="${prefix}-feedback"></div>
        <div class="hint" id="${prefix}-hint"></div>
      </div>`;
    document.getElementById(`${prefix}-input`).focus();
    attempts = 0;
  }

  function checkAnswer(p) {
    const input = document.getElementById(`${prefix}-input`);
    const feedback = document.getElementById(`${prefix}-feedback`);
    const hintEl = document.getElementById(`${prefix}-hint`);
    const q = questions[current];
    const val = input.value;
    const correct = normalise(q.answer);
    const given = normalise(val);

    attempts++;

    if (given === correct || (q.alts && q.alts.map(normalise).includes(given))) {
      // Correct!
      input.classList.add('correct');
      feedback.className = 'feedback correct show';
      const pts = attempts === 1 ? 10 : 5;
      addScore(pts);
      sectionScore += pts;
      feedback.innerHTML = attempts === 1
        ? `üéâ Excellent! "+${pts} points! The answer is <strong>${q.answer}</strong>.`
        : `‚úÖ Correct! The answer is <strong>${q.answer}</strong>. (+${pts} points)`;
      input.disabled = true;
      document.getElementById(`${prefix}-check-btn`).disabled = true;
      document.getElementById(`${prefix}-next-btn`).disabled = false;
      document.getElementById(`${prefix}-next-btn`).classList.remove('btn-disabled');
      if (attempts === 1) launchConfetti(20);
      hintEl.textContent = '';
    } else if (attempts >= 2) {
      // Reveal after 2 attempts
      input.classList.add('wrong');
      feedback.className = 'feedback reveal show';
      feedback.innerHTML = `üí° The correct answer is: <strong>${q.answer}</strong>`;
      resetStreak();
      input.disabled = true;
      document.getElementById(`${prefix}-check-btn`).disabled = true;
      document.getElementById(`${prefix}-next-btn`).disabled = false;
      document.getElementById(`${prefix}-next-btn`).classList.remove('btn-disabled');
      hintEl.textContent = '';
    } else {
      // First wrong attempt
      input.classList.add('wrong');
      feedback.className = 'feedback wrong show';
      feedback.innerHTML = `‚ùå Not quite! Try again. Here's a hint:`;
      hintEl.textContent = 'üí° ' + q.hint;
      resetStreak();
      setTimeout(() => {
        input.classList.remove('wrong');
        input.value = '';
        input.focus();
      }, 800);
    }
  }

  function nextQ(p) {
    current++;
    render();
  }

  function showResults() {
    const area = document.getElementById(areaId);
    document.getElementById(progressBarId).style.width = '100%';
    document.getElementById(progressTextId).textContent = '20 / 20';
    const stars = sectionScore >= 160 ? '‚≠ê‚≠ê‚≠ê' : sectionScore >= 100 ? '‚≠ê‚≠ê' : '‚≠ê';
    area.innerHTML = `
      <div class="results-card">
        <div class="big">${sectionScore}</div>
        <div class="sub">points in this section</div>
        <div class="stars-anim">${stars}</div>
        <p style="color:var(--muted);">You completed all 20 questions!</p>
        <button class="btn btn-restart" onclick="restartSection('${prefix}')">üîÑ Try Again</button>
      </div>`;
    sectionsDone[prefix === 'rel' ? 'relative' : 'gerund'] = true;
    launchConfetti(60);
    document.getElementById(`tab-${prefix === 'rel' ? 'relative' : 'gerund'}`).innerHTML +=
      '<span class="completed-badge">‚úì</span>';
  }

  function restartSection(p) {
    current = 0; sectionScore = 0;
    render();
  }

  // Expose globally
  window[`checkAnswer`] = window[`checkAnswer`] || {};
  window[`nextQ`] = window[`nextQ`] || {};

  // Use a mapping approach
  if (prefix === 'rel') {
    window._rel = { checkAnswer, nextQ, render };
  } else {
    window._ger = { checkAnswer, nextQ, render };
  }

  render();
}

// Dispatcher
function checkAnswer(prefix) {
  if (prefix === 'rel') window._rel.checkAnswer(prefix);
  else window._ger.checkAnswer(prefix);
}
function nextQ(prefix) {
  if (prefix === 'rel') window._rel.nextQ(prefix);
  else window._ger.nextQ(prefix);
}

// Init both sections
buildSection(relativeQuestions, 'rel', 'rel-question-area', 'rel-progress', 'rel-progress-text');
buildSection(gerundQuestions, 'ger', 'ger-question-area', 'ger-progress', 'ger-progress-text');

// ===== SECTION NAV =====
function showSection(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('section-' + name).classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
}

// ===== HAMLET WRITING =====
function updateWordCount() {
  const text = document.getElementById('hamlet-writing').value.trim();
  const words = text === '' ? 0 : text.split(/\s+/).length;
  document.getElementById('word-count').textContent = words + (words === 1 ? ' word' : ' words');
}

function submitWriting() {
  const text = document.getElementById('hamlet-writing').value.trim();
  const words = text === '' ? 0 : text.split(/\s+/).length;
  const feedback = document.getElementById('writing-feedback');

  if (words < 30) {
    feedback.style.display = 'block';
    feedback.className = 'writing-feedback show';
    feedback.innerHTML = `<strong style="color:var(--red)">‚úèÔ∏è Keep going!</strong> You've written ${words} words. Try to write at least 5 good sentences (around 60‚Äì80 words). You can do it!`;
    return;
  }

  let msg = '';
  let pts = 0;

  if (words >= 30 && words < 60) {
    msg = `Good start! You wrote ${words} words. Can you add a bit more detail?`;
    pts = 20;
  } else if (words >= 60 && words < 100) {
    msg = `Well done! ${words} words ‚Äî that's a solid summary!`;
    pts = 35;
  } else {
    msg = `Fantastic! ${words} words ‚Äî you've written a really detailed and impressive summary! üèÜ`;
    pts = 50;
    launchConfetti(80);
  }

  addScore(pts);
  feedback.className = 'writing-feedback show';
  feedback.style.display = 'block';
  feedback.innerHTML = `<strong style="color:var(--green)">‚úÖ Great job!</strong> ${msg}<br><br>
    <span style="color:var(--accent)">+${pts} points added to your score!</span><br><br>
    <strong>Things to check in your summary:</strong><br>
    ‚úî Did you mention Hamlet and Claudius?<br>
    ‚úî Did you explain what Claudius did?<br>
    ‚úî Did you say how the story ends?<br>
    ‚úî Did you write in your own words?`;
}
</script>
</body>
</html>
